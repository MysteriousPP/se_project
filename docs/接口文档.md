# Flutter 前端接口文档
**文档版本**：V1.0
**更新时间**：[填写当前日期]
**适用项目**：Silver Care App

## 一、基础信息
- 后端基础地址（桌面端）：`http://localhost:8000`，适合同机运行 Go 后端的场景
- 后端基础地址（Android 模拟器）：`http://10.0.2.2:8000`，针对 Android Studio AVD 模拟器
- 后端基础地址（Genymotion 模拟器）：`http://10.0.3.2:8000`，适配 Genymotion 模拟器环境
- 后端基础地址（真机测试）：`http://192.168.1.100:8000`，需替换为电脑实际的局域网 IP
- 请求格式：JSON，请求头固定携带 `Content-Type: application/json`
- 通用响应格式：`Map<String, dynamic>`，接口调用成功返回解析后的 JSON 数据，失败返回 null
- 调试日志：Debug 模式下自动打印请求地址、参数、响应状态码及响应内容，便于问题排查

## 二、接口列表
### 1. 用户模块（UserApi）
#### （1）创建用户
- 接口功能：老人端/子女端新用户注册
- 请求方法：POST
- 完整请求路径：`{基础地址}/user`（例：`http://localhost:8000/user`）
- 请求参数（JSON 格式）：支持后端接收的任意用户信息字段，示例如下：
  ```json
  {
    "username": "zhangsan",
    "password": "123456",
    "role": "elder", // elder=老人端，child=子女端
    "phone": "13800138000",
    "email": "zhangsan@example.com"
  }
  ```
- 响应参数（JSON 格式）：
  - 成功响应示例：
    ```json
    {
      "code": 200,
      "msg": "创建成功",
      "data": {
        "userId": 1,
        "username": "zhangsan",
        "role": "elder"
      }
    }
    ```
  - 失败响应：null
- 异常处理：捕获调用异常并打印日志，前端无崩溃风险

#### （2）绑定老人
- 接口功能：子女端绑定老人账号，建立亲属关联
- 请求方法：POST
- 完整请求路径：`{基础地址}/user/bindElder`（例：`http://localhost:8000/user/bindElder`）
- 请求参数（JSON 格式）：支持绑定关系相关字段，示例如下：
  ```json
  {
    "childId": 2, // 子女用户ID
    "elderId": 1, // 老人用户ID
    "relation": "父子" // 亲属关系
  }
  ```
- 响应参数（JSON 格式）：
  - 成功响应示例：
    ```json
    {
      "code": 200,
      "msg": "绑定成功",
      "data": {
        "bindId": 1,
        "childId": 2,
        "elderId": 1,
        "relation": "父子"
      }
    }
    ```
  - 失败响应：null
- 异常处理：捕获调用异常并打印日志，前端无崩溃风险

#### （3）用户登录
- 接口功能：老人端/子女端身份验证，获取登录凭证
- 请求方法：POST
- 完整请求路径：`{基础地址}/user/login`（例：`http://localhost:8000/user/login`）
- 请求参数（JSON 格式）：
  ```json
  {
    "username": "zhangsan", // 账号（手机号/邮箱/用户名）
    "password": "123456"    // 密码
  }
  ```
- 响应参数（JSON 格式）：
  - 成功响应示例：
    ```json
    {
      "code": 200,
      "msg": "登录成功",
      "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // JWT 令牌
        "userId": 1,
        "username": "zhangsan",
        "role": "elder"
      }
    }
    ```
  - 失败响应示例：
    ```json
    {
      "code": 401,
      "msg": "账号或密码错误"
    }
    ```
  - 异常响应：null
- 异常处理：捕获调用异常并打印日志，前端无崩溃风险

### 2. 健康模块（HealthApi）
#### （1）上传血压数据
- 接口功能：老人端上传血压测量记录至后端
- 请求方法：POST
- 完整请求路径（优先顺序）：
  1. `{基础地址}/health/uploadBp`（例：`http://localhost:8000/health/uploadBp`）
  2. `{基础地址}/uploadBp`
  3. `{基础地址}/health/bp`
  4. `{基础地址}/bp`
- 请求参数（JSON 格式）：
  ```json
  {
    "elderId": 1,        // 老人用户ID
    "time": "2025-05-20T10:30:00.000Z", // ISO8601 格式测量时间
    "value": "120/80",   // 血压值（收缩压/舒张压）
    "device": "家用电子血压计" // 测量设备（可选）
  }
  ```
- 响应参数（JSON 格式）：
  - 成功响应示例：
    ```json
    {
      "code": 200,
      "msg": "上传成功",
      "data": {
        "recordId": 101,
        "elderId": 1,
        "time": "2025-05-20T10:30:00.000Z",
        "value": "120/80"
      }
    }
    ```
  - 失败响应：null
- 异常处理：自动遍历备选路径尝试调用，单路径失败仅打印日志，不中断流程

#### （2）发送 SOS 报警
- 接口功能：老人端触发紧急报警，推送报警信息至后端
- 请求方法：POST
- 完整请求路径（优先顺序）：
  1. `{基础地址}/health/sos`（例：`http://localhost:8000/health/sos`）
  2. `{基础地址}/sos`
- 请求参数（JSON 格式）：
  ```json
  {
    "elderId": 1,        // 老人用户ID
    "time": "2025-05-20T14:20:00.000Z", // 报警触发时间
    "location": "XX小区3号楼2单元501", // 报警位置（可选）
    "type": "紧急求助"   // 报警类型（可选）
  }
  ```
- 响应参数（JSON 格式）：
  - 成功响应示例：
    ```json
    {
      "code": 200,
      "msg": "报警信息已推送",
      "data": {
        "sosId": 501,
        "elderId": 1,
        "time": "2025-05-20T14:20:00.000Z",
        "status": "已通知家属"
      }
    }
    ```
  - 失败响应：null
- 异常处理：自动遍历备选路径尝试调用，单路径失败仅打印日志，不中断流程

#### （3）获取健康概览
- 接口功能：获取老人健康数据概览/历史记录
- 请求方法：GET
- 完整请求路径（优先顺序）：
  1. `{基础地址}/health/overview`（例：`http://localhost:8000/health/overview`）
  2. `{基础地址}/health`
  3. `{基础地址}/overview`
  4. `{基础地址}/`
- 请求参数：无（GET 请求无 Body 参数，可通过 URL 参数传参，示例：`{基础地址}/health/overview?elderId=1`）
- 响应参数（JSON 格式）：
  - 成功响应示例（非空时）：
    ```json
    {
      "raw": "{\"code\":200,\"msg\":\"查询成功\",\"data\":{\"elderId\":1,\"latestBp\":\"120/80\",\"bpHistory\":[{\"time\":\"2025-05-20T10:30:00.000Z\",\"value\":\"120/80\"},{\"time\":\"2025-05-19T10:30:00.000Z\",\"value\":\"125/85\"}]}}"
    }
    ```
  - 失败响应：null
- 异常处理：自动遍历备选路径尝试调用，单路径失败仅打印日志，不中断流程

## 三、本地存储服务说明（无后端接口，纯前端）
### 1. 血压记录服务（BpService）
#### （1）加载最新血压
- 功能：读取本地缓存的最新血压记录
- 存储键名：`latest_bp`
- 数据结构（JSON 格式）：
  ```json
  {
    "time": "2025-05-20T10:30:00.000Z", // ISO8601 格式时间
    "value": "120/80"                   // 血压值
  }
  ```
- 业务说明：加载失败时返回 null，不影响前端流程

#### （2）保存最新血压
- 功能：将最新血压记录持久化到本地缓存
- 存储键名：`latest_bp`
- 入参数据结构（JSON 格式）：同「加载最新血压」的存储结构
- 业务说明：保存失败仅捕获异常，不抛错

#### （3）加载血压历史
- 功能：读取本地缓存的最近血压记录（最多 5 条）
- 存储键名：`bp_history`
- 数据结构（JSON 格式）：
  ```json
  [
    {
      "time": "2025-05-20T10:30:00.000Z",
      "value": "120/80"
    },
    {
      "time": "2025-05-19T10:30:00.000Z",
      "value": "125/85"
    }
  ]
  ```
- 业务说明：最多返回 5 条记录，无数据时返回空列表

#### （4）保存血压历史
- 功能：追加新血压记录并截断为最近 5 条，持久化到本地
- 存储键名：`bp_history`
- 入参数据结构：单条血压记录（同「加载最新血压」结构）
- 业务说明：自动截断超过 5 条的记录，保存失败仅捕获异常

### 2. 联系人服务（ContactService）
#### （1）加载联系人
- 功能：读取本地缓存的联系人列表
- 存储键名：`contacts_v1`
- 数据结构（JSON 格式）：
  ```json
  [
    {
      "name": "张三",    // 联系人姓名
      "relation": "儿子",// 亲属关系
      "phone": "13800138000", // 联系电话
      "icon": "person"   // 图标标识
    }
  ]
  ```
- 业务说明：无数据时返回空列表

#### （2）加载已删联系人
- 功能：读取本地缓存的已删除联系人列表
- 存储键名：`contacts_deleted_v1`
- 数据结构：同「加载联系人」的结构
- 业务说明：无数据时返回空列表

#### （3）添加联系人
- 功能：新增联系人并持久化到本地
- 存储键名：`contacts_v1`
- 入参数据结构（JSON 格式）：
  ```json
  {
    "name": "李四",
    "relation": "女儿",
    "phone": "13900139000",
    "icon": "person"
  }
  ```
- 业务说明：添加失败仅捕获异常

#### （4）删除联系人
- 功能：将联系人移至已删除列表（非彻底删除）
- 入参：待删除的联系人对象（同「添加联系人」结构）
- 业务说明：操作失败仅捕获异常

#### （5）恢复联系人
- 功能：将已删除联系人移回正常列表
- 入参：待恢复的联系人对象（同「添加联系人」结构）
- 业务说明：操作失败仅捕获异常

#### （6）彻底删除联系人
- 功能：从已删除列表移除联系人并更新缓存
- 入参：已删除列表中联系人的索引（int 类型）
- 业务说明：索引越界时无操作，不抛错

### 3. 任务/用药提醒服务（TaskService）
#### （1）加载任务列表
- 功能：读取本地缓存的任务/用药提醒列表
- 存储键名：`tasks_v1`
- 数据结构（JSON 格式）：
  ```json
  [
    {
      "id": 1,                // 唯一ID
      "content": "早上8点吃药",// 任务内容
      "status": false,        // 完成状态（false=未完成，true=完成）
      "time": "08:00",        // 提醒时间（可选）
      "date": "2025-05-20",   // 提醒日期（可选）
      "drugName": "降压药",    // 药品名称（可选）
      "drugSpec": "5mg/片"    // 药品规格（可选）
    }
  ]
  ```
- 业务说明：无数据时返回空列表

#### （2）添加任务
- 功能：新增任务/用药提醒并持久化
- 存储键名：`tasks_v1`
- 入参数据结构（JSON 格式）：
  ```json
  {
    "content": "晚上8点测血压",
    "time": "20:00",
    "date": "2025-05-20",
    "drugName": "",
    "drugSpec": ""
  }
  ```
- 业务说明：自动生成唯一 ID，ID 从 1 自增，添加失败仅捕获异常

#### （3）删除任务
- 功能：根据 ID 删除指定任务
- 入参：任务 ID（int 类型）
- 业务说明：无对应 ID 时无操作，不抛错

#### （4）切换任务状态
- 功能：根据 ID 切换任务完成状态
- 入参：任务 ID（int 类型）
- 业务说明：无对应 ID 时无操作，不抛错

#### （5）更新任务
- 功能：根据 ID 更新任务/用药提醒信息
- 入参数据结构（JSON 格式）：
  ```json
  {
    "id": 1,
    "content": "早上9点吃药",
    "status": false,
    "time": "09:00",
    "date": "2025-05-20",
    "drugName": "降压药",
    "drugSpec": "5mg/片"
  }
  ```
- 业务说明：无对应 ID 时无操作，不抛错

